{% extends 'base.html' %}

{% block title %}Flux{% endblock %}

{% block content %}
<a href="{% url 'create_ticket' %}"> <button type="button"> Demander une critique </button></a>
<a href="{% url 'create_review' %}"> <button type="button"> Créer une critique </button></a>
{% for ticket in tickets %}
	<div>
		<div>
			<p> 
				{% if username == ticket.user.username %} 
					Vous avez demandé une critique 
				{% else %}
					{{ ticket.user.username }} a demandé une critique
				{% endif %} 
			</p>
			<p>
				{{ ticket.time_created }}
			</p>
		</div>
		<div>
			<p> {{ ticket.title }} </p>
			<p> {{ ticket.description }} </p>
		</div>
		<div>
			{{ ticket.image }}
		</div>
		{% if username != ticket.user.username or ticket.reviews.count > 0 %} <button type="button"><a href="{% url 'create_review' %}"> Créer une critique </a></button> {% endif %}
	</div>
{% endfor %}
{% for review in reviews %}
	{{ review.ticket }}
	<div>
		<div>
			<p> 
				{% if username == review.user.username %} 
					Vous avez posté une critique 
				{% else %}
					{{ review.user.username }} a posté une critique
				{% endif %} 
			</p>
			<p>
				{{ review.time_created }}
			</p>
		</div>
		<div>
			<p> {{ review.rating }} </p>
			<p> {{ review.headline }} </p>
			<p> {{ review.body }} </p>
		</div>
		{% if review.ticket %}
			<div>
				<p> Ticket - {{ review.ticket.user.username }}</p>
				<p> {{review.ticket.title}} </p>
				<p> {{review.ticket.image}} </p>
			</div>
		{% endif %}
	</div>
{% endfor %}
{% endblock %}